package com.wiesfight.activities;

import main.com.wiesfight.dto.User;
import main.com.wiesfight.persistence.UserPersistence;

import com.google.gson.Gson;
import com.parse.ParseException;
import com.parse.ParseQuery;
import com.wiesfight.R;
import com.wiesfight.managers.PreferencesManager;

import android.app.Activity;
import android.app.AlertDialog;
import android.content.DialogInterface;
import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.preference.PreferenceManager;
import android.view.View;
import android.widget.ImageView;

public class SettingsActivity extends Activity {
	Boolean soundOn;
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_settings);
		this.setResult(RESULT_OK);
		this.soundOn = PreferencesManager.getSoundPreference(this);
		if(!this.soundOn) {
			ImageView img = (ImageView) findViewById(R.id.imgSound);
			img.setImageResource(R.drawable.wyl);
		}
	}
	
	public void switchSound(View v) {
		ImageView img = (ImageView) findViewById(R.id.imgSound);
		if(!this.soundOn) {
			this.soundOn = true;
			img.setImageResource(R.drawable.wl);
		}
		else {
			this.soundOn = false;
			img.setImageResource(R.drawable.wyl);
		}
		PreferencesManager.putSoundPreference(this, this.soundOn);
	}
	
	public void showHowToPlay(View v) {
		
	}
	
	public void deleteCharacter(View v) {
		SharedPreferences mPrefs = PreferenceManager.getDefaultSharedPreferences(this);
        Gson gson = new Gson();
        String json = mPrefs.getString("currentUser", "");
        User user = gson.fromJson(json, User.class);
        ParseQuery<UserPersistence> query = ParseQuery.getQuery(UserPersistence.class);
    	query.whereEqualTo("Username", user.getUserName());
    	try {
			UserPersistence userPer = query.getFirst();
			userPer.deleteInBackground();
		} catch (ParseException e) {
			return;
		}
    	Intent intent = new Intent(this, LoginActivity.class);
    	startActivity(intent);
        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
    	finish();
	}
	
	public void leaveGame(View v) {
		new AlertDialog.Builder(this)
	        .setIcon(android.R.drawable.ic_dialog_alert)
	        .setTitle("PotwierdŸ")
	        .setMessage("Czy na pewno chcesz wyjœæ z gry?")
	        .setPositiveButton("Tak", new DialogInterface.OnClickListener() {
	        	@Override
	        	public void onClick(DialogInterface dialog, int which) {
	        		setResult(RESULT_CANCELED);
	        		finish();    
	        	}
	    })
	    .setNegativeButton("Nie", null)
	    .show();
	}
}
